import{r as S,j as e,u as de,a as G}from"./client-CJnX4qAx.js";import{c as B,S as ae}from"./Sidebar-BAhWtxfF.js";import{u as H,j as _,k as K,l as W,m as J,n as Q,o as X,F as l,a as c,b as i,c as d,I as u,d as a,S as A,e as I,f as $,g as O,h as g,p as Y,B as L,D as Z,q as M}from"./index-BUtqJqcX.js";import{P as ee}from"./plus-CgB9mJF2.js";/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],z=B("pencil",xe);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],U=B("trash-2",he),je=async(b,n,o=!1,m,f)=>{const x={owner:b,name:n.name,label:n.label,description:n.description,repository:n.repository,content:n.content,store:n.store};let y="/api/configuration",p="POST";o&&m&&f&&(y=`/api/configuration/${m}/${f}`,p="PUT");const h=await fetch(y,{method:p,headers:{"Content-Type":"application/json"},body:JSON.stringify(x)});if(!h.ok){const j=await h.json();throw new Error(`API antwortete mit Status: ${h.status}, Error: ${j.error||"Unbekannter Fehler"}`)}return h.json()},q=({refetchConfigurations:b,isEditing:n=!1,initialData:o=null,configName:m,configOwner:f,onClose:x,owner:y})=>{const[p,h]=S.useState(null),[j,w]=S.useState(null),[N,C]=S.useState(n),s=H({defaultValues:{name:"",label:"",description:"",repository:"",content:"ALL",store:""}});S.useEffect(()=>{n&&o&&s.reset({name:o.name||"",label:o.label||"",description:o.description||"",repository:o.repository||"",content:o.content||"ALL",store:o.store||""})},[n,o,s]);const F=async r=>{try{h(null),w(null);const T=await je(y,r,n,f,m);w("Configuration was successfully created!"),setTimeout(()=>{w(null)},5e3),b(),C(!1),s.reset(),x&&x()}catch(T){console.error("Error saving the configuration:",T),h(T.message),setTimeout(()=>{h(null)},5e3)}},k=()=>{C(!1),x&&x()};return n?e.jsx(_,{open:N,onOpenChange:r=>{C(r),!r&&x&&x()},children:e.jsxs(K,{children:[e.jsxs(W,{children:[e.jsx(J,{children:"Edit Configuration"}),e.jsx(Q,{children:"Edit the configuration settings"})]}),e.jsx(X,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(F),children:[p&&e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:[e.jsx("strong",{children:"Error:"})," ",p]}),j&&e.jsxs("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4",children:[e.jsx("strong",{children:"Success:"})," ",j]}),e.jsx(l,{control:s.control,name:"name",render:({field:r})=>e.jsxs(c,{children:[e.jsx(i,{children:"Name"}),e.jsx(d,{children:e.jsx(u,{...r})}),e.jsx(a,{})]})}),e.jsx(l,{control:s.control,name:"label",render:({field:r})=>e.jsxs(c,{children:[e.jsx(i,{children:"Label"}),e.jsx(d,{children:e.jsx(u,{...r})}),e.jsx(a,{})]})}),e.jsx(l,{control:s.control,name:"description",render:({field:r})=>e.jsxs(c,{children:[e.jsx(i,{children:"Description"}),e.jsx(d,{children:e.jsx(u,{...r})}),e.jsx(a,{})]})}),e.jsx(l,{control:s.control,name:"content",render:({field:r})=>e.jsxs(c,{children:[e.jsx(i,{children:"Content Type"}),e.jsxs(A,{onValueChange:r.onChange,defaultValue:r.value,children:[e.jsx(d,{children:e.jsx(I,{children:e.jsx($,{placeholder:"Wähle Content-Type"})})}),e.jsxs(O,{children:[e.jsx(g,{value:"ALL",children:"All"}),e.jsx(g,{value:"DEFAULTS",children:"Defaults"}),e.jsx(g,{value:"OVERRIDES",children:"Overrides"})]})]}),e.jsx(a,{})]})}),e.jsx(l,{control:s.control,name:"store",render:({field:r})=>e.jsxs(c,{children:[e.jsx(i,{children:"Store"}),e.jsx(d,{children:e.jsx(u,{...r})}),e.jsx(a,{})]})}),e.jsx(l,{control:s.control,name:"repository",render:({field:r})=>e.jsxs(c,{children:[e.jsx(i,{children:"Repository"}),e.jsx(d,{children:e.jsx(u,{...r})}),e.jsx(a,{})]})}),e.jsxs(Y,{className:"mt-4",children:[e.jsx(L,{variant:"outline",type:"button",onClick:k,children:"Cancel"}),e.jsx(L,{type:"submit",children:"Submit"})]})]})})]})}):e.jsxs(Z,{trigger:"Add",triggerIcon:ee,title:"Add Configuration",description:"Fill out the following fields to create a new configuration.",applyAction:F,applyTitle:"Submit",closeTitle:"Cancel",hookForm:s,children:[p&&e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:[e.jsx("strong",{children:"Error:"})," ",p]}),j&&e.jsxs("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4",children:[e.jsx("strong",{children:"Success:"})," ",j]}),e.jsx(l,{control:s.control,name:"name",render:({field:r})=>e.jsxs(c,{children:[e.jsx(i,{children:"Name"}),e.jsx(d,{children:e.jsx(u,{...r})}),e.jsx(a,{})]})}),e.jsx(l,{control:s.control,name:"label",render:({field:r})=>e.jsxs(c,{children:[e.jsx(i,{children:"Label"}),e.jsx(d,{children:e.jsx(u,{...r})}),e.jsx(a,{})]})}),e.jsx(l,{control:s.control,name:"description",render:({field:r})=>e.jsxs(c,{children:[e.jsx(i,{children:"Description"}),e.jsx(d,{children:e.jsx(u,{...r})}),e.jsx(a,{})]})}),e.jsx(l,{control:s.control,name:"content",render:({field:r})=>e.jsxs(c,{children:[e.jsx(i,{children:"Content Type"}),e.jsxs(A,{onValueChange:r.onChange,defaultValue:r.value,children:[e.jsx(d,{children:e.jsx(I,{children:e.jsx($,{placeholder:"Wähle Content-Type"})})}),e.jsxs(O,{children:[e.jsx(g,{value:"ALL",children:"All"}),e.jsx(g,{value:"DEFAULTS",children:"Defaults"}),e.jsx(g,{value:"OVERRIDES",children:"Overrides"})]})]}),e.jsx(a,{})]})}),e.jsx(l,{control:s.control,name:"store",render:({field:r})=>e.jsxs(c,{children:[e.jsx(i,{children:"Store"}),e.jsx(d,{children:e.jsx(u,{...r})}),e.jsx(a,{})]})}),e.jsx(l,{control:s.control,name:"repository",render:({field:r})=>e.jsxs(c,{children:[e.jsx(i,{children:"Repository"}),e.jsx(d,{children:e.jsx(u,{...r})}),e.jsx(a,{})]})})]})},ue=async(b,n,o=!1,m,f)=>{const x={owner:b,name:n.name,label:n.label,description:n.description,scope:n.scope,type:n.type,url:n.url};let y="/api/store",p="POST";o&&m&&f&&(y=`/api/store/${m}/${f}`,p="PUT");const h=await fetch(y,{method:p,headers:{"Content-Type":"application/json"},body:JSON.stringify(x)});if(!h.ok){const j=await h.json();throw new Error(`API antwortete mit Status: ${h.status}, Error: ${j.error||"Unbekannter Fehler"}`)}return h.json()},R=({refetchStores:b,isEditing:n=!1,initialData:o=null,storeName:m,storeOwner:f,onClose:x,owner:y})=>{const[p,h]=S.useState(null),[j,w]=S.useState(null),[N,C]=S.useState(n),s=H({defaultValues:{name:"",label:"",description:"",type:"GITEA",scope:"",url:""}});S.useEffect(()=>{n&&o&&s.reset({name:o.name||"",label:o.label||"",description:o.description||"",scope:o.scope||"",type:o.type||"GITEA",url:o.url||""})},[n,o,s]);const F=async r=>{try{h(null),w(null);const T=await ue(y,r,n,f,m);w("Store was successfully created!"),setTimeout(()=>{w(null)},5e3),b(),C(!1),s.reset(),x&&x()}catch(T){console.error("Fehler beim Speichern des Stores:",T),h(T.message),setTimeout(()=>{h(null)},5e3)}},k=()=>{C(!1),x&&x()};return n?e.jsx(_,{open:N,onOpenChange:r=>{C(r),!r&&x&&x()},children:e.jsxs(K,{children:[e.jsxs(W,{children:[e.jsx(J,{children:"Edit Store"}),e.jsx(Q,{children:"Edit the stores"})]}),e.jsx(X,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(F),children:[p&&e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:[e.jsx("strong",{children:"Error:"})," ",p]}),j&&e.jsxs("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4",children:[e.jsx("strong",{children:"Success:"})," ",j]}),e.jsx(l,{control:s.control,name:"name",render:({field:r})=>e.jsxs(c,{children:[e.jsx(i,{children:"Name"}),e.jsx(d,{children:e.jsx(u,{...r})}),e.jsx(a,{})]})}),e.jsx(l,{control:s.control,name:"label",render:({field:r})=>e.jsxs(c,{children:[e.jsx(i,{children:"Label"}),e.jsx(d,{children:e.jsx(u,{...r})}),e.jsx(a,{})]})}),e.jsx(l,{control:s.control,name:"description",render:({field:r})=>e.jsxs(c,{children:[e.jsx(i,{children:"Description"}),e.jsx(d,{children:e.jsx(u,{...r})}),e.jsx(a,{})]})}),e.jsx(l,{control:s.control,name:"type",render:({field:r})=>e.jsxs(c,{children:[e.jsx(i,{children:"Type"}),e.jsxs(A,{onValueChange:r.onChange,defaultValue:r.value,children:[e.jsx(d,{children:e.jsx(I,{children:e.jsx($,{placeholder:"Select content type"})})}),e.jsxs(O,{children:[e.jsx(g,{value:"GITHUB",children:"Github"}),e.jsx(g,{value:"GITEA",children:"Gitea"}),e.jsx(g,{value:"GITLAB",children:"Gitlab"}),e.jsx(g,{value:"S3",children:"S3"})]})]}),e.jsx(a,{})]})}),e.jsx(l,{control:s.control,name:"scope",render:({field:r})=>e.jsxs(c,{children:[e.jsx(i,{children:"Scope"}),e.jsx(d,{children:e.jsx(u,{...r})}),e.jsx(a,{})]})}),e.jsx(l,{control:s.control,name:"url",render:({field:r})=>e.jsxs(c,{children:[e.jsx(i,{children:"Url"}),e.jsx(d,{children:e.jsx(u,{...r})}),e.jsx(a,{})]})}),e.jsxs(Y,{className:"mt-4",children:[e.jsx(L,{variant:"outline",type:"button",onClick:k,children:"Cancel"}),e.jsx(L,{type:"submit",children:"Submit"})]})]})})]})}):e.jsx(e.Fragment,{children:e.jsxs(Z,{trigger:"Add",triggerIcon:ee,title:"Add Store",description:"Fill out the following fields to create a new store.",applyAction:F,applyTitle:"Submit",closeTitle:"Cancel",hookForm:s,children:[p&&e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:[e.jsx("strong",{children:"Error:"})," ",p]}),j&&e.jsxs("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4",children:[e.jsx("strong",{children:"Success:"})," ",j]}),e.jsx(l,{control:s.control,name:"name",render:({field:r})=>e.jsxs(c,{children:[e.jsx(i,{children:"Name"}),e.jsx(d,{children:e.jsx(u,{...r})}),e.jsx(a,{})]})}),e.jsx(l,{control:s.control,name:"label",render:({field:r})=>e.jsxs(c,{children:[e.jsx(i,{children:"Label"}),e.jsx(d,{children:e.jsx(u,{...r})}),e.jsx(a,{})]})}),e.jsx(l,{control:s.control,name:"description",render:({field:r})=>e.jsxs(c,{children:[e.jsx(i,{children:"Description"}),e.jsx(d,{children:e.jsx(u,{...r})}),e.jsx(a,{})]})}),e.jsx(l,{control:s.control,name:"type",render:({field:r})=>e.jsxs(c,{children:[e.jsx(i,{children:"Type"}),e.jsxs(A,{onValueChange:r.onChange,defaultValue:r.value,children:[e.jsx(d,{children:e.jsx(I,{children:e.jsx($,{placeholder:"Wähle Typ"})})}),e.jsxs(O,{children:[e.jsx(g,{value:"GITHUB",children:"Github"}),e.jsx(g,{value:"GITEA",children:"Gitea"}),e.jsx(g,{value:"GITLAB",children:"Gitlab"}),e.jsx(g,{value:"S3",children:"S3"})]})]}),e.jsx(a,{})]})}),e.jsx(l,{control:s.control,name:"scope",render:({field:r})=>e.jsxs(c,{children:[e.jsx(i,{children:"Scope"}),e.jsx(d,{children:e.jsx(u,{...r})}),e.jsx(a,{})]})}),e.jsx(l,{control:s.control,name:"url",render:({field:r})=>e.jsxs(c,{children:[e.jsx(i,{children:"Url"}),e.jsx(d,{children:e.jsx(u,{...r})}),e.jsx(a,{})]})})]})})},pe=async b=>{const n=await fetch(`/api/configuration/${b}`);if(!n.ok)throw new Error(`API antwortete mit Status: ${n.status}`);return n.json()},me=async b=>{const n=await fetch(`/api/store/${b}`);if(!n.ok)throw new Error(`API antwortete mit Status: ${n.status}`);return n.json()},Se=function(){const[n,o]=S.useState(null),[m,f]=S.useState(null),[x,y]=S.useState(null),[p,h]=S.useState(!1),{owner:j,isLoadingSettings:w,settingsError:N}=de(),{data:C=[],isLoading:s,error:F,refetch:k}=G({queryKey:["configurations",j],queryFn:()=>pe(j)}),{data:r=[],isLoading:T,error:re,refetch:P}=G({queryKey:["stores",j],queryFn:()=>me(j)}),se=(t,v)=>{confirm("Möchtest du diese Konfiguration wirklich löschen?")&&(o(null),fetch(`/api/configuration/${t}/${v}`,{method:"DELETE"}).then(E=>{if(E.ok)k();else return E.json().then(D=>{throw new Error(D.error||"Fehler beim Löschen")})}).catch(E=>{console.error("Fehler beim Löschen:",E),o(E.message)}))},ne=(t,v)=>{confirm("Möchtest du diesen Store wirklich löschen?")&&(o(null),fetch(`/api/store/${t}/${v}`,{method:"DELETE"}).then(E=>{if(E.ok)P();else return E.json().then(D=>{throw new Error(D.error||"Fehler beim Löschen")})}).catch(E=>{console.error("Fehler beim Löschen:",E),o(E.message)}))},te=t=>{f(t),h(!0)},oe=t=>{y(t),h(!0)},le=()=>{f(null),h(!1)},ce=()=>{y(null),h(!1)},ie=s||T||w,V=F||re||N;return e.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen p-4",children:e.jsx(ae,{children:e.jsxs("div",{className:"p-4",children:[n&&e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:[e.jsx("strong",{children:"Fehler:"})," ",n]}),ie?e.jsx("p",{children:"Lade Daten..."}):V?e.jsx("p",{className:"text-red-500",children:V.message}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-9",children:e.jsx(M,{title:"Configurations",description:"Existing configurations",rows:C.map(t=>({label:t.label,description:t.description,owner:t.owner,content:t.content,store:t.store,repository:t.repository,delete:e.jsx(L,{variant:"ghost",size:"icon",onClick:v=>{v.stopPropagation(),se(t.owner,t.name)},className:"text-red-500 hover:text-red-700",children:e.jsx(U,{size:16})}),edit:e.jsx(L,{variant:"ghost",size:"icon",onClick:v=>{v.stopPropagation(),te(t)},className:"text-blue-500 hover:text-blue-700",children:e.jsx(z,{size:16})})})),actions:e.jsx(q,{refetchConfigurations:k,owner:j})})}),e.jsx("div",{className:"mb-9",children:e.jsx(M,{title:"Stores",description:"Existing stores",rows:r.map(t=>({label:t.label,description:t.description,owner:t.owner,scope:t.scope,type:t.type,url:t.url,delete:e.jsx(L,{variant:"ghost",size:"icon",onClick:v=>{v.stopPropagation(),ne(t.owner,t.name)},className:"text-red-500 hover:text-red-700",children:e.jsx(U,{size:16})}),edit:e.jsx(L,{variant:"ghost",size:"icon",onClick:v=>{v.stopPropagation(),oe(t)},className:"text-blue-500 hover:text-blue-700",children:e.jsx(z,{size:16})})})),actions:e.jsx(R,{refetchStores:P,owner:j})})}),p&&m&&e.jsx(q,{refetchConfigurations:k,isEditing:!0,initialData:m,configName:m.name,configOwner:m.owner,onClose:le,owner:j}),p&&x&&e.jsx(R,{refetchStores:P,isEditing:!0,initialData:x,storeName:x.name,storeOwner:x.owner,onClose:ce,owner:j})]})]})})})};export{Se as component};
